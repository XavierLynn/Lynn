var showRealData = JKB["能源分析"]["客户特征分析"]["标签分类占比"];

var table_data = [
   
  {
    "name": "基本信息",
    "children": [
      {
        "name": "行业分类（国标）",
        "children": [
          {
            "name": "国标行业大类",
            "value": 0
          },
          {
            "name": "国标行业门类",
            "value": 3
          },
          {
            "name": "国标行业小类",
            "value": 0
          },
          {
            "name": "国标行业中类",
            "value": 0
          },
          {
            "name": "行业能耗分类",
            "value": 0
          }
        ]
      },
      {
        "name": "企业规模\n（大中小型企业）",
        "children": [
          {
            "name": "建筑面积（平方米）",
            "value": 0
          },
          {
            "name": "注册资本",
            "value": 0
          },
          {
            "name": "人员规模",
            "value": 0
          },
          {
            "name": "企业性质",
            "value": 0
          }
        ]
      },
      {
        "name": "产业分类",
        "children": [
          {
            "name": "国标产业分类",
            "value": 5
          }
        ]
      },
      {
        "name": "行业分类\n（实际情况）",
        "children": [
          {
            "name": "实际行业大类",
            "value": 0
          },
          {
            "name": "实际行业中类",
            "value": 0
          },
          {
            "name": "实际行业小类",
            "value": 0
          },
          {
            "name": "实际行业门类",
            "value": 0
          }
        ]
      },
      {
        "name": "区域",
        "children": [
          {
            "name": "张江科学城",
            "value": 716
          },
          {
            "name": "浦东新区",
            "value": 0
          }
        ]
      },
      {
        "name": "行业分类（企标）",
        "children": [
          {
            "name": "企标行业门类",
            "value": 0
          },
          {
            "name": "企标行业大类",
            "value": 0
          },
          {
            "name": "企标行业中类",
            "value": 0
          },
          {
            "name": "企标行业小类",
            "value": 0
          }
        ]
      }
    ]
  },
  {
    "name": "能源属性",
    "children": [
      {
        "name": "燃气属性",
        "children": [
          {
            "name": "用气性质分类",
            "value": 0
          }
        ]
      },
      {
        "name": "电力属性",
        "children": [
          {
            "name": "用电类别",
            "value": 0
          },
          {
            "name": "电压等级（kV）",
            "value": 0
          },
          {
            "name": "电源性质",
            "value": 0
          },
          {
            "name": "户龄",
            "value": 0
          },
          {
            "name": "保电重要用户",
            "value": 0
          }
        ]
      },
      {
        "name": "水务属性",
        "children": [
          {
            "name": "用水性质分类",
            "value": 0
          }
        ]
      },
      {
        "name": "综合能源属性",
        "children": [
          {
            "name": "新能源",
            "value": 0
          },
          {
            "name": "能源管理",
            "value": 0
          },
          {
            "name": "电能替代",
            "value": 0
          }
        ]
      }
    ]
  },
  {
    "name": "用能特征",
    "children": [
      {
        "name": "用电特征",
        "children": [
          {
            "name": "峰谷比情况",
            "value": 0
          },
          {
            "name": "电量变化特征",
            "value": 0
          },
          {
            "name": "负荷特征标签",
            "value": 0
          },
          {
            "name": "超需量",
            "value": 0
          },
          {
            "name": "基本电费",
            "value": 0
          },
          {
            "name": "张江电量排名",
            "value": 0
          },
          {
            "name": "违约用电、窃电历史处理情况",
            "value": 0
          },
          {
            "name": "超容监控",
            "value": 0
          },
          {
            "name": "有功负载率",
            "value": 0
          },
          {
            "name": "变压器运行情况",
            "value": 0
          },
          {
            "name": "光伏自给率",
            "value": 0
          },
          {
            "name": "需求侧响应历史参与情况",
            "value": 0
          },
          {
            "name": "功率因数达标情况",
            "value": 0
          },
          {
            "name": "生产规律",
            "value": 0
          }
        ]
      },
      {
        "name": "用电安全",
        "children": [
          {
            "name": "运行环境",
            "value": 0
          },
          {
            "name": "应急能力",
            "value": 0
          },
          {
            "name": "运维团队",
            "value": 0
          },
          {
            "name": "特殊客户",
            "value": 0
          },
          {
            "name": "设备运行情况",
            "value": 0
          },
          {
            "name": "用电安全风险等级",
            "value": 0
          },
          {
            "name": "设备状态",
            "value": 0
          },
          {
            "name": "预防性试验",
            "value": 0
          },
          {
            "name": "历史事故",
            "value": 0
          }
        ]
      },
      {
        "name": "能效特征",
        "children": [
          {
            "name": "万元产值能耗",
            "value": 0
          },
          {
            "name": "单位面积能耗",
            "value": 0
          }
        ]
      },
      {
        "name": "综合能耗",
        "children": [
          {
            "name": "近期能耗增长",
            "value": 0
          },
          {
            "name": "主要消耗能源",
            "value": 0
          },
          {
            "name": "综合能耗水平",
            "value": 0
          }
        ]
      }
    ]
  },
  {
    "name": "交互特征",
    "children": [
      {
        "name": "关注度",
        "children": [
          {
            "name": "商品关注类别",
            "value": 0
          },
          {
            "name": "金融渠道关注类别",
            "value": 0
          },
          {
            "name": "资讯关注类别",
            "value": 0
          },
          {
            "name": "成果案例关注类别",
            "value": 0
          },
          {
            "name": "搜索频率",
            "value": 0
          },
          {
            "name": "能源俱乐部关注类别",
            "value": 0
          },
          {
            "name": "关注综合能源领域",
            "value": 0
          },
          {
            "name": "功能关注点",
            "value": 3
          },
          {
            "name": "需求关注类别",
            "value": 6
          }
        ]
      },
      {
        "name": "缴费逾期",
        "children": [
          {
            "name": "电费逾期风险",
            "value": 0
          },
          {
            "name": "欠费停电",
            "value": 0
          },
          {
            "name": "逾期特征",
            "value": 0
          }
        ]
      },
      {
        "name": "活跃度",
        "children": [
          {
            "name": "登录频次",
            "value": 0
          },
          {
            "name": "最近登陆",
            "value": 0
          },
          {
            "name": "在线时长",
            "value": 0
          }
        ]
      },
      {
        "name": "消费能力",
        "children": [
          {
            "name": "消费频次",
            "value": 0
          },
          {
            "name": "消费金额",
            "value": 0
          },
          {
            "name": "最近消费时间",
            "value": 0
          }
        ]
      }
    ]
  },
  {
    "name": "客户价值",
    "children": [
      {
        "name": "需求响应潜力",
        "children": [
          {
            "name": "需求响应潜力分析",
            "value": 0
          }
        ]
      },
      {
        "name": "价值度",
        "children": [
          {
            "name": "消费潜力分析",
            "value": 449
          }
        ]
      },
      {
        "name": "信用度",
        "children": [
          {
            "name": "电力客户信用评价",
            "value": 0
          }
        ]
      },
      {
        "name": "电力市场",
        "children": [
          {
            "name": "售电意愿",
            "value": 1
          }
        ]
      },
      {
        "name": "节能潜力",
        "children": [
          {
            "name": "节能潜力分析",
            "value": 0
          }
        ]
      }
    ]
  }
//     ]
//   }

];

$(function () {
  Flush();
  $.ajax({
      url: "http://localhost:2277/监控版/NYFX.asmx/GetRegionHYXFPM",
      type: "POST",
      async: true,
      data: "regionID=zj&startDate=2019-12&endDate=2020-01",
      error: function() {
          Flush();

      },
      success: function (data) {
          if (showRealData) {
              table_data = JSON.parse(data);
              Flush();
          }
      }
  });

  //延迟刷新
  setInterval(function () { $('body').css('background-color', 'rgba(0,0,0,0.00)'); }, 2000);
});

function Flush() {
    $('.nav').empty();
    $('.nav').append("<li id='tag'>◀</li>");
    $('.nav').append("<li role='presentation'><a href='#title0' aria-controls='profile' role='tab' data-toggle='tab'>标签分类占比</a></li>");

    function colorMappingChange(value) {
        var levelOption = getLevelOption(value);
        chart.setOption({
            series: [{
                levels: levelOption
            }]
        });
    }

    var formatUtil = echarts.format;

    function getLevelOption() {
        return [ {
            itemStyle: {
                normal: {
                    borderColor: '#777',
                    borderWidth: 0,
                    gapWidth: 1
                }
            },
            upperLabel: {
                normal: {
                    show: false
                }
            }
        },
        {
            itemStyle: {
                normal: {
                    borderColor: '#555',
                    borderWidth: 5,
                    gapWidth: 1
                },
                emphasis: {
                    borderColor: '#ddd'
                }
            }
        },
        {
            colorSaturation: [0.35, 0.5],
            itemStyle: {
                normal: {
                    borderWidth: 5,
                    gapWidth: 1,
                    borderColorSaturation: 0.6
                }
            }
        }
        ];
    }

    const myChart = echarts.init(document.getElementById('show_charts'));
    myChart.setOption(option = {
        tooltip: {
            formatter: function(info) {
                var value = info.value;
                var treePathInfo = info.treePathInfo;
                var treePath = [];

                for (var i = 1; i < treePathInfo.length; i++) {
                    treePath.push(treePathInfo[i].name);
                }

                return [
                    '<div class="tooltip-title">' + formatUtil.encodeHTML(treePath.join('/')) + '</div>',
                    '数量: ' + formatUtil.addCommas(value),
                ].join('');
            },
            textStyle: {
                fontSize: globalFontSize,
            }

        },
        // color: ['#8CDFFF', '#51BBFF', '#0084FF', '#517CFF', '#2850FF', ],
         color: ['#6FAFFA', '#81BCFA', '#8DC3FF', '#7CC6FF', '#90C3E0', '#727BE8', '#85F8FF', '#0B4EFF'],
        // color: ['#F00', '#0F0', '#00F', '#FF0', '#0FF',],
        series: [{
            name: '标签分类',
            type: 'treemap',
            visibleMin: 300,
            top: 0,
            left: 0,
            bottom: 0,
            right: 0,
            // roam: false,
            // leafDepth: 1,
            label: {
                show: true,
                formatter: '{b}',
                fontSize: globalFontSize - 5,
            },  
            upperLabel: {
                normal: {
                    fontSize:50,
                    show: true,
                    // fontSize: globalFontSize - 5,
                    height: 80
                }
            },
            itemStyle: {
                normal: {
                    borderColor: 'rgba(255,255,255,0)'
                }
            },
            breadcrumb: {
                top: 1500,
                height: 70,
                emptyItemWidth: 70,
                itemStyle: {
                    color: 'rgba(0,0,0,0.2)',
                    textStyle: {
                        fontSize: globalFontSize - 5,
                        color: globalFontColor,
                        height: 40
                    }
                }
            },
            levels: getLevelOption(),
            data: table_data
        }]
    });
};

ue.interface.Flush = function () {
  Flush();
}

ue.interface.Load = function (data) {
  var jsonData = JSON.parse(data);
  $.ajax({
      url: "http://localhost:2277/监控版/NYFX.asmx/" + jsonData['FunctionName'],
      type: "POST",
      async: true,
      data: jsonData['FunctionParam'],
      error: function () {
          Flush();
      },
      success: function (data) {
          if (showRealData) {
              table_data = JSON.parse(data);
              Flush();
          }
      }
  });

}